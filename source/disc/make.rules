# ------------------------------------------------------------------------------
# Source folder paths
# ------------------------------------------------------------------------------

SRC_PATH_DISC       := $(SRC_PATH)/disc
SRC_PATH_DISC_BOOT  := $(SRC_PATH_DISC)/boot
SRC_PATH_DISC_FILES := $(SRC_PATH_DISC)/files

# ------------------------------------------------------------------------------
# Object folder paths
# ------------------------------------------------------------------------------

OBJ_PATH_DISC_BOOT  := $(OBJ_PATH)/$(SRC_PATH_DISC_BOOT)

# ------------------------------------------------------------------------------
# Files
# ------------------------------------------------------------------------------

SRC_DISC_BOOT       := $(SRC_PATH_DISC_BOOT)/header.asm \
                       $(SRC_PATH_DISC_BOOT)/boot.asm
OBJ_DISC_BOOT       := $(patsubst %.asm,$(OBJ_PATH)/%.o,$(SRC_DISC_BOOT))
DEPEND_DISC_BOOT    := $(patsubst %.o,%.d,$(OBJ_DISC_BOOT))

SRC_DISC_FILES      := $(wildcard $(SRC_PATH_DISC_FILES)/*.*)
OUT_DISC_FILES      := $(patsubst $(SRC_PATH_DISC_FILES)/%,$(FILES_PATH)/%,$(SRC_DISC_FILES))

# ------------------------------------------------------------------------------
# Dependencies
# ------------------------------------------------------------------------------

ifneq ($(MAKECMDGOALS),$(filter $(MAKECMDGOALS),clean))
-include $(DEPEND_DISC_BOOT)
endif

# ------------------------------------------------------------------------------
# Boot rules
# ------------------------------------------------------------------------------

$(OUT_DISC_BOOT): $(OBJ_DISC_BOOT) | $(OUT_DISC_FILES)
	$(LINKING)
	@$(VLINK) $(VLINK_FLAGS) -T $(SRC_PATH_DISC)/link_boot.link -o $@ $^

$(OBJ_DISC_BOOT): $(OBJ_PATH)/%.o: %.asm | $(DEPEND_DISC_BOOT)
	$(ASSEMBLING)
	@$(VASM_M68K) $(VASM_M68K_FLAGS) -o $@ $<

$(DEPEND_DISC_BOOT): $(OBJ_PATH)/%.d: %.asm | $(OBJ_PATH_DISC_BOOT)
	$(MAKING_DEPENDS)
	@$(MAKE_DEPEND) $(MAKE_DEPEND_FLAGS) -o $@ $(patsubst %.d,%.o,$@) $<

# ------------------------------------------------------------------------------
# Files rules
# ------------------------------------------------------------------------------

$(OUT_DISC_FILES):
	$(COPYING)
	@$(COPY) "$(SRC_PATH_DISC_FILES)" "$(FILES_PATH)" > nul

# ------------------------------------------------------------------------------
# Create folders
# ------------------------------------------------------------------------------

$(OBJ_PATH_DISC_BOOT): | $(OBJ_PATH)
	@$(MKDIR) "$@"

# ------------------------------------------------------------------------------